<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI PR Reviewer</title>
    <style>
        :root { 
            --primary-color: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary-color: #64748b;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --critical-color: #dc2626;
            --background: #f8fafc;
            --surface: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
                    }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--background);
            color: var(--text-primary);
            line-height: 1.5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .main-card {
            background: var(--surface);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }

        .platform-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            background: var(--background);
            padding: 0.25rem;
            border-radius: 8px;
        }

        .platform-tab {
            flex: 1;
            padding: 0.75rem 1rem;
            border: none;
            background: transparent;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }

        .platform-tab.active {
            background: var(--primary-color);
            color: white;
        }

        .demo-section {
            margin-bottom: 1.5rem;
        }

        .demo-label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .demo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.75rem;
        }

        .demo-btn {
            padding: 0.75rem;
            background: var(--background);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            text-align: left;
            transition: all 0.2s;
        }

        .demo-btn:hover {
            border-color: var(--primary-color);
            background: white;
        }

        .form-grid {
            display: grid;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 200px;
            gap: 1rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .form-input, .form-textarea, .form-select {
            padding: 0.75rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 0.9rem;
            transition: border-color 0.2s;
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgb(37 99 235 / 0.1);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
            font-family: 'Monaco', 'Menlo', monospace;
        }

        .code-textarea {
            min-height: 200px;
        }

        .analyze-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin: 0 auto;
        }

        .analyze-btn:hover:not(:disabled) {
            background: var(--primary-dark);
        }

        .analyze-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            display: none;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .results {
            margin-top: 2rem;
            display: none;
        }

        .summary-card {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
        }

        .summary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .summary-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .score-display {
            text-align: center;
        }

        .score-number {
            font-size: 2rem;
            font-weight: 700;
        }

        .score-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .summary-badges {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .badge {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .badge.critical { background: rgba(239, 68, 68, 0.2); color: var(--critical-color); }
        .badge.high { background: rgba(245, 158, 11, 0.2); color: var(--warning-color); }
        .badge.medium { background: rgba(59, 130, 246, 0.2); color: var(--primary-color); }
        .badge.low { background: rgba(16, 185, 129, 0.2); color: var(--success-color); }

        .issues-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .issue-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            border-left: 4px solid;
        }

        .issue-card.critical { border-left-color: var(--critical-color); }
        .issue-card.high { border-left-color: var(--warning-color); }
        .issue-card.medium { border-left-color: var(--primary-color); }
        .issue-card.low { border-left-color: var(--success-color); }

        .issue-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
            gap: 1rem;
        }

        .issue-title {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--text-primary);
        }

        .issue-meta {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            flex-shrink: 0;
        }

        .issue-description {
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .code-block {
            background: var(--background);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.85rem;
            margin: 1rem 0;
            overflow-x: auto;
        }

        .suggestion {
            background: var(--background);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .suggestion-title {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .no-issues {
            text-align: center;
            padding: 2rem;
            color: var(--success-color);
        }

        .no-issues-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .demo-grid {
                grid-template-columns: 1fr;
            }

            .issue-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }

            .summary-header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🤖 AI PR Reviewer</h1>
            <p>Intelligent code analysis for pull requests with security, performance, and logic insights</p>
        </div>

        <div class="main-card">
            <!-- Platform Selection -->
            <div class="platform-tabs">
                <button class="platform-tab active" data-platform="github">GitHub</button>
                <button class="platform-tab" data-platform="gitlab">GitLab</button>
                <button class="platform-tab" data-platform="cli">CLI Tool</button>
            </div>

            <!-- Demo Examples -->
            <div class="demo-section">
                <div class="demo-label">Quick Demo Examples:</div>
                <div class="demo-grid">
                    <button class="demo-btn" onclick="loadDemo('security')">
                        🔒 Security Issues<br>
                        <small>SQL injection, weak auth</small>
                    </button>
                    <button class="demo-btn" onclick="loadDemo('performance')">
                        ⚡ Performance Issues<br>
                        <small>N+1 queries, inefficient loops</small>
                    </button>
                    <button class="demo-btn" onclick="loadDemo('logic')">
                        🧠 Logic Errors<br>
                        <small>Assignment vs comparison</small>
                    </button>
                    <button class="demo-btn" onclick="loadDemo('clean')">
                        ✅ Clean Code<br>
                        <small>Best practices example</small>
                    </button>
                </div>
            </div>

            <!-- Input Form -->
            <div class="form-grid">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Commit Message</label>
                        <textarea id="commitMessage" class="form-textarea" placeholder="Describe your changes (e.g., feat: Add user authentication system)"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Language</label>
                        <select id="language" class="form-select">
                            <option value="javascript">JavaScript</option>
                            <option value="typescript">TypeScript</option>
                            <option value="python">Python</option>
                            <option value="java">Java</option>
                            <option value="csharp">C#</option>
                            <option value="php">PHP</option>
                            <option value="ruby">Ruby</option>
                            <option value="go">Go</option>
                            <option value="rust">Rust</option>
                            <option value="kotlin">Kotlin</option>
                            <option value="swift">Swift</option>
                            <option value="cpp">C++</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Code Changes</label>
                    <textarea id="codeChanges" class="form-textarea code-textarea" placeholder="Paste your code diff, full code, or modified functions here..."></textarea>
                </div>
            </div>

            <button class="analyze-btn" onclick="analyzeCode()">
                <div class="spinner"></div>
                <span>Analyze Pull Request</span>
            </button>

            <!-- Results -->
            <div class="results" id="results">
                <div class="summary-card" id="summary"></div>
                <div class="issues-list" id="issues"></div>
            </div>
        </div>
    </div>

    <script>
        let currentPlatform = 'github';

        // Platform tabs
        document.querySelectorAll('.platform-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelector('.platform-tab.active').classList.remove('active');
                tab.classList.add('active');
                currentPlatform = tab.dataset.platform;
            });
        });

        // Enhanced demo data with language-specific examples
        const demos = {
            security: {
                commit: "feat: Add user authentication with session management",
                code: `// JavaScript - Security Issues Demo
app.post('/login', (req, res) => {
    const { username, password } = req.body;
    
    // SQL Injection vulnerability
    const query = \`SELECT * FROM users WHERE username = '\${username}' AND password = '\${password}'\`;
    
    db.query(query, (err, results) => {
        if (results.length > 0) {
            // Storing sensitive data in session
            req.session.password = password;
            req.session.user = results[0];
            
            // XSS vulnerability
            document.getElementById('welcome').innerHTML = 'Welcome ' + username;
            
            res.json({ success: true, user: results[0] });
        } else {
            res.status(401).json({ success: false });
        }
    });
});

// Weak JWT secret
const token = jwt.sign({ userId: user.id }, 'secret123');

// Code injection risk
const userCode = req.body.code;
eval(userCode); // Never do this!`
            },
            performance: {
                commit: "perf: Optimize data loading and processing",
                code: `// JavaScript - Performance Issues Demo
async function loadUserDashboard(userId) {
    // N+1 Query Problem
    const user = await db.query('SELECT * FROM users WHERE id = ?', [userId]);
    
    // Sequential queries in loop
    for (let post of user.posts) {
        const postData = await db.query('SELECT * FROM posts WHERE id = ?', [post.id]);
        post.details = postData;
        
        // Nested N+1 problem
        for (let comment of post.comments) {
            const commentUser = await db.query('SELECT * FROM users WHERE id = ?', [comment.userId]);
            comment.user = commentUser;
        }
    }
    
    // Inefficient string concatenation
    let html = '';
    for (let i = 0; i < 1000; i++) {
        html += '<div>' + data[i] + '</div>';
    }
    
    // Inefficient timeout usage
    setTimeout(() => {
        updateCache(user);
    }, 0);
    
    // Object creation in loop
    for (let i = 0; i < items.length; i++) {
        const processor = new DataProcessor();
        results.push(processor.process(items[i]));
    }
    
    return user;
}`
            },
            logic: {
                commit: "fix: Update validation logic and error handling",
                code: `// JavaScript - Logic Errors Demo
function validateUserAccess(user, resource) {
    // Assignment instead of comparison
    if (user.role = 'admin') {
        return true;
    }
    
    // Incorrect operator precedence
    if (user.active && user.permissions.includes('read') || user.isGuest) {
        return true;
    }
    
    // Missing return statement
    if (user.isPremium) {
        console.log('Premium user detected');
    }
    
    // Redundant boolean comparison
    if (user.verified === true && resource.public === false) {
        return false;
    }
    
    // Loose equality causing type coercion
    if (user.age == "18") {
        return allowAccess();
    }
    
    // Unreachable code
    return false;
    console.log('This will never execute');
    user.lastAccess = new Date();
}

// Missing await in async function
async function processData() {
    const data = fetchUserData(); // Missing await
    return data.process();
}`
            },
            clean: {
                commit: "refactor: Implement secure user service with best practices",
                code: `// JavaScript - Clean Code Demo
const bcrypt = require('bcrypt');
const validator = require('validator');
const rateLimit = require('express-rate-limit');

class UserService {
    constructor(database, logger) {
        this.db = database;
        this.logger = logger;
        this.saltRounds = 12;
    }
    
    async createUser(userData) {
        try {
            // Input validation with specific error messages
            const validation = await this.validateUserInput(userData);
            if (!validation.isValid) {
                throw new ValidationError(validation.errors);
            }
            
            // Check for existing user with parameterized query
            const existingUser = await this.db.query(
                'SELECT id FROM users WHERE email = ? OR username = ?',
                [userData.email, userData.username]
            );
            
            if (existingUser.length > 0) {
                throw new ConflictError('User already exists');
            }
            
            // Secure password hashing
            const hashedPassword = await bcrypt.hash(userData.password, this.saltRounds);
            
            // Transaction for data integrity
            const result = await this.db.transaction(async (trx) => {
                const user = await trx.query(
                    'INSERT INTO users (username, email, password_hash, created_at) VALUES (?, ?, ?, ?)',
                    [userData.username, userData.email, hashedPassword, new Date()]
                );
                
                await trx.query(
                    'INSERT INTO user_profiles (user_id, display_name) VALUES (?, ?)',
                    [user.insertId, userData.displayName || userData.username]
                );
                
                return user;
            });
            
            // Proper logging
            this.logger.info(\`User created successfully: \${userData.username}\`, {
                userId: result.insertId,
                timestamp: new Date().toISOString()
            });
            
            // Return sanitized user data
            return {
                id: result.insertId,
                username: userData.username,
                email: userData.email,
                createdAt: new Date()
            };
            
        } catch (error) {
            this.logger.error('User creation failed:', {
                error: error.message,
                stack: error.stack,
                userData: { username: userData.username, email: userData.email }
            });
            throw error;
        }
    }
    
    async validateUserInput(userData) {
        const errors = [];
        
        // Username validation
        if (!userData.username || userData.username.length < 3) {
            errors.push('Username must be at least 3 characters long');
        }
        
        if (!/^[a-zA-Z0-9_-]+$/.test(userData.username)) {
            errors.push('Username can only contain letters, numbers, underscores, and hyphens');
        }
        
        // Email validation
        if (!validator.isEmail(userData.email)) {
            errors.push('Please provide a valid email address');
        }
        
        // Password validation
        if (!this.isValidPassword(userData.password)) {
            errors.push('Password must be at least 8 characters with uppercase, lowercase, and numbers');
        }
        
        return {
            isValid: errors.length === 0,
            errors
        };
    }
    
    isValidPassword(password) {
        const minLength = 8;
        const hasUpperCase = /[A-Z]/.test(password);
        const hasLowerCase = /[a-z]/.test(password);
        const hasNumbers = /\d/.test(password);
        
        return password.length >= minLength && hasUpperCase && hasLowerCase && hasNumbers;
    }
}`
            }
        };

        function loadDemo(type) {
            const demo = demos[type];
            document.getElementById('commitMessage').value = demo.commit;
            document.getElementById('codeChanges').value = demo.code;
        }

        function analyzeCode() {
            const commitMessage = document.getElementById('commitMessage').value.trim();
            const codeChanges = document.getElementById('codeChanges').value.trim();
            const language = document.getElementById('language').value;

            if (!commitMessage || !codeChanges) {
                alert('Please provide both commit message and code changes');
                return;
            }

            // Show loading
            const btn = document.querySelector('.analyze-btn');
            const spinner = btn.querySelector('.spinner');
            const span = btn.querySelector('span');
            
            btn.disabled = true;
            spinner.style.display = 'block';
            span.textContent = 'Analyzing...';

            // Simulate analysis
            setTimeout(() => {
                const analysis = performAnalysis(commitMessage, codeChanges, language);
                showResults(analysis);
                
                // Reset button
                btn.disabled = false;
                spinner.style.display = 'none';
                span.textContent = 'Analyze Pull Request';
            }, 2500);
        }

        // Language-specific analysis patterns
        const languagePatterns = {
            javascript: {
                security: [
                    {
                        pattern: /SELECT.*FROM.*WHERE.*\$\{.*\}/gi,
                        severity: 'critical',
                        title: 'SQL Injection Vulnerability',
                        description: 'String interpolation in SQL queries allows injection attacks.',
                        suggestion: 'Use parameterized queries with placeholders (?, $1, etc.)',
                        score: -25
                    },
                    {
                        pattern: /innerHTML\s*=.*\+|innerHTML\s*=.*\$\{/gi,
                        severity: 'high',
                        title: 'XSS Vulnerability',
                        description: 'Dynamic innerHTML assignment can lead to cross-site scripting.',
                        suggestion: 'Use textContent, createElement, or sanitize HTML input.',
                        score: -20
                    },
                    {
                        pattern: /eval\s*\(/gi,
                        severity: 'critical',
                        title: 'Code Injection Risk',
                        description: 'eval() can execute arbitrary code and is a major security risk.',
                        suggestion: 'Avoid eval(). Use JSON.parse() for data or specific parsing methods.',
                        score: -30
                    }
                ],
                performance: [
                    {
                        pattern: /for.*\{[^}]*await.*query/gi,
                        severity: 'high',
                        title: 'N+1 Query Problem',
                        description: 'Database queries inside loops cause performance bottlenecks.',
                        suggestion: 'Use JOIN queries or batch operations to reduce database calls.',
                        score: -20
                    },
                    {
                        pattern: /setTimeout.*0\)/gi,
                        severity: 'medium',
                        title: 'Inefficient Async Pattern',
                        description: 'setTimeout(..., 0) is an anti-pattern for async operations.',
                        suggestion: 'Use Promise.resolve().then() or proper async/await patterns.',
                        score: -8
                    }
                ],
                logic: [
                    {
                        pattern: /if\s*\([^)]*=\s*[^=]/gi,
                        severity: 'critical',
                        title: 'Assignment in Condition',
                        description: 'Assignment operator (=) used instead of comparison (===).',
                        suggestion: 'Use === for strict equality or == for loose equality.',
                        score: -25
                    },
                    {
                        pattern: /[^=!]==[^=]/gi,
                        severity: 'medium',
                        title: 'Loose Equality Comparison',
                        description: 'Using == can cause unexpected type coercion.',
                        suggestion: 'Use === for strict equality comparison.',
                        score: -8
                    }
                ],
                quality: [
                    {
                        pattern: /\bvar\s+/gi,
                        severity: 'low',
                        title: 'Legacy Variable Declaration',
                        description: 'Using var can cause scope-related issues.',
                        suggestion: 'Use const for constants and let for mutable variables.',
                        score: -3
                    },
                    {
                        pattern: /const\s+\w+|let\s+\w+/gi,
                        severity: 'low',
                        title: 'Modern Variable Declarations',
                        description: 'Good use of modern const/let declarations.',
                        suggestion: 'Excellent! Continue using const and let.',
                        score: 3,
                        positive: true
                    }
                ]
            },
            python: {
                security: [
                    {
                        pattern: /f".*SELECT.*FROM.*\{.*\}"/gi,
                        severity: 'critical',
                        title: 'SQL Injection Vulnerability',
                        description: 'F-string formatting in SQL queries allows injection attacks.',
                        suggestion: 'Use parameterized queries with cursor.execute(sql, params).',
                        score: -25
                    },
                    {
                        pattern: /exec\s*\(|eval\s*\(/gi,
                        severity: 'critical',
                        title: 'Code Injection Risk',
                        description: 'exec() and eval() can execute arbitrary code.',
                        suggestion: 'Avoid exec/eval. Use ast.literal_eval for safe evaluation.',
                        score: -30
                    },
                    {
                        pattern: /pickle\.loads?\(.*input/gi,
                        severity: 'high',
                        title: 'Unsafe Deserialization',
                        description: 'Pickle can execute arbitrary code during deserialization.',
                        suggestion: 'Use JSON or implement custom serialization for untrusted data.',
                        score: -20
                    }
                ],
                performance: [
                    {
                        pattern: /for\s+\w+\s+in.*:\s*\n.*\.execute\(/gi,
                        severity: 'high',
                        title: 'Database Queries in Loop',
                        description: 'Multiple database queries in loops cause performance issues.',
                        suggestion: 'Use bulk operations or JOIN queries.',
                        score: -20
                    },
                    {
                        pattern: /\+\s*=.*\[.*\]/gi,
                        severity: 'medium',
                        title: 'Inefficient List Concatenation',
                        description: 'Using += for list concatenation is inefficient.',
                        suggestion: 'Use list.extend() or list comprehension.',
                        score: -8
                    }
                ],
                logic: [
                    {
                        pattern: /except\s*:/gi,
                        severity: 'medium',
                        title: 'Bare Except Clause',
                        description: 'Catching all exceptions can hide important errors.',
                        suggestion: 'Catch specific exception types: except ValueError, TypeError:',
                        score: -10
                    },
                    {
                        pattern: /is\s+(True|False)|==\s*(True|False)/gi,
                        severity: 'low',
                        title: 'Redundant Boolean Comparison',
                        description: 'Comparing with True/False is unnecessary.',
                        suggestion: 'Use the boolean value directly: if condition:',
                        score: -5
                    }
                ],
                quality: [
                    {
                        pattern: /global\s+\w+/gi,
                        severity: 'low',
                        title: 'Global Variable Usage',
                        description: 'Global variables can make code harder to test and maintain.',
                        suggestion: 'Consider passing variables as parameters or using class attributes.',
                        score: -5
                    },
                    {
                        pattern: /with\s+open\(|contextlib\./gi,
                        severity: 'low',
                        title: 'Proper Resource Management',
                        description: 'Good use of context managers for resource handling.',
                        suggestion: 'Excellent! Context managers ensure proper cleanup.',
                        score: 5,
                        positive: true
                    }
                ]
            },
            java: {
                security: [
                    {
                        pattern: /Statement.*executeQuery.*\+/gi,
                        severity: 'critical',
                        title: 'SQL Injection Vulnerability',
                        description: 'String concatenation in SQL queries allows injection attacks.',
                        suggestion: 'Use PreparedStatement with parameterized queries.',
                        score: -25
                    },
                    {
                        pattern: /Runtime\.getRuntime\(\)\.exec/gi,
                        severity: 'critical',
                        title: 'Command Injection Risk',
                        description: 'Executing system commands can be exploited.',
                        suggestion: 'Validate and sanitize all inputs, use ProcessBuilder.',
                        score: -30
                    }
                ],
                performance: [
                    {
                        pattern: /for.*\{.*new\s+\w+\(/gi,
                        severity: 'medium',
                        title: 'Object Creation in Loop',
                        description: 'Creating objects repeatedly in loops affects performance.',
                        suggestion: 'Move object creation outside the loop or use object pooling.',
                        score: -10
                    },
                    {
                        pattern: /String.*\+.*\+/gi,
                        severity: 'medium',
                        title: 'Inefficient String Concatenation',
                        description: 'String concatenation creates multiple temporary objects.',
                        suggestion: 'Use StringBuilder for multiple concatenations.',
                        score: -8
                    }
                ],
                logic: [
                    {
                        pattern: /if\s*\([^)]*=\s*[^=]/gi,
                        severity: 'critical',
                        title: 'Assignment in Condition',
                        description: 'Assignment operator (=) used instead of comparison (==).',
                        suggestion: 'Use == for comparison or .equals() for objects.',
                        score: -25
                    },
                    {
                        pattern: /==.*String|String.*==/gi,
                        severity: 'high',
                        title: 'String Comparison with ==',
                        description: 'Using == for string comparison checks reference, not value.',
                        suggestion: 'Use .equals() or .compareTo() for string comparison.',
                        score: -15
                    }
                ],
                quality: [
                    {
                        pattern: /System\.out\.print/gi,
                        severity: 'low',
                        title: 'Console Output in Production Code',
                        description: 'System.out should not be used in production code.',
                        suggestion: 'Use proper logging framework like SLF4J or Log4j.',
                        score: -3
                    },
                    {
                        pattern: /private\s+final\s+|final\s+class/gi,
                        severity: 'low',
                        title: 'Proper Encapsulation',
                        description: 'Good use of final and private modifiers.',
                        suggestion: 'Excellent! Proper encapsulation improves code quality.',
                        score: 3,
                        positive: true
                    }
                ]
            },
            csharp: {
                security: [
                    {
                        pattern: /SqlCommand.*CommandText.*\+/gi,
                        severity: 'critical',
                        title: 'SQL Injection Vulnerability',
                        description: 'String concatenation in SQL commands allows injection attacks.',
                        suggestion: 'Use parameterized queries with SqlParameter.',
                        score: -25
                    },
                    {
                        pattern: /Process\.Start.*input/gi,
                        severity: 'high',
                        title: 'Command Injection Risk',
                        description: 'Starting processes with user input can be dangerous.',
                        suggestion: 'Validate and sanitize all inputs before executing.',
                        score: -20
                    }
                ],
                performance: [
                    {
                        pattern: /for.*\{.*new\s+\w+\(/gi,
                        severity: 'medium',
                        title: 'Object Allocation in Loop',
                        description: 'Frequent object creation can cause GC pressure.',
                        suggestion: 'Reuse objects or use object pooling patterns.',
                        score: -10
                    },
                    {
                        pattern: /string.*\+.*\+/gi,
                        severity: 'medium',
                        title: 'Inefficient String Concatenation',
                        description: 'String concatenation creates multiple temporary objects.',
                        suggestion: 'Use StringBuilder or string interpolation ($"").',
                        score: -8
                    }
                ],
                logic: [
                    {
                        pattern: /if\s*\([^)]*=\s*[^=]/gi,
                        severity: 'critical',
                        title: 'Assignment in Condition',
                        description: 'Assignment operator (=) used instead of comparison (==).',
                        suggestion: 'Use == for comparison or .Equals() for objects.',
                        score: -25
                    }
                ],
                quality: [
                    {
                        pattern: /Console\.Write/gi,
                        severity: 'low',
                        title: 'Console Output in Production',
                        description: 'Console output should not be used in production code.',
                        suggestion: 'Use ILogger or other logging frameworks.',
                        score: -3
                    },
                    {
                        pattern: /using\s*\(.*\)|await\s+using/gi,
                        severity: 'low',
                        title: 'Proper Resource Disposal',
                        description: 'Good use of using statements for resource management.',
                        suggestion: 'Excellent! Using statements ensure proper disposal.',
                        score: 5,
                        positive: true
                    }
                ]
            },
            php: {
                security: [
                    {
                        pattern: /mysql_query.*\$|mysqli_query.*\$_/gi,
                        severity: 'critical',
                        title: 'SQL Injection Vulnerability',
                        description: 'Direct variable interpolation in SQL queries is dangerous.',
                        suggestion: 'Use prepared statements with PDO or mysqli.',
                        score: -25
                    },
                    {
                        pattern: /eval\s*\(|\$\$|extract\s*\(/gi,
                        severity: 'critical',
                        title: 'Code Injection Risk',
                        description: 'eval(), variable variables, and extract() are dangerous.',
                        suggestion: 'Avoid eval() and variable variables. Sanitize extract() input.',
                        score: -30
                    }
                ],
                performance: [
                    {
                        pattern: /for.*\{.*mysql_query/gi,
                        severity: 'high',
                        title: 'Database Queries in Loop',
                        description: 'Multiple database queries in loops cause performance issues.',
                        suggestion: 'Use JOINs or prepare statements outside loops.',
                        score: -20
                    }
                ],
                logic: [
                    {
                        pattern: /if\s*\([^)]*=\s*[^=]/gi,
                        severity: 'critical',
                        title: 'Assignment in Condition',
                        description: 'Assignment operator (=) used instead of comparison (==).',
                        suggestion: 'Use == for comparison or === for strict comparison.',
                        score: -25
                    }
                ],
                quality: [
                    {
                        pattern: /\<\?php|\<\?=|\<\?/gi,
                        severity: 'low',
                        title: 'PHP Tag Usage',
                        description: 'Using proper PHP opening tags.',
                        suggestion: 'Always use <?php instead of short tags.',
                        score: 2,
                        positive: true
                    }
                ]
            },
            ruby: {
                security: [
                    {
                        pattern: /ActiveRecord.*find_by_sql.*\#\{/gi,
                        severity: 'critical',
                        title: 'SQL Injection Vulnerability',
                        description: 'String interpolation in SQL queries allows injection attacks.',
                        suggestion: 'Use parameterized queries or ActiveRecord methods.',
                        score: -25
                    },
                    {
                        pattern: /eval\s*\(|instance_eval/gi,
                        severity: 'high',
                        title: 'Code Injection Risk',
                        description: 'eval() and instance_eval() can execute arbitrary code.',
                        suggestion: 'Avoid eval methods. Use send() with symbol validation.',
                        score: -25
                    }
                ],
                performance: [
                    {
                        pattern: /\.times\s*\{.*find\(/gi,
                        severity: 'high',
                        title: 'N+1 Query Problem',
                        description: 'Database queries inside iteration blocks cause performance issues.',
                        suggestion: 'Use includes(), joins(), or preload() for eager loading.',
                        score: -20
                    }
                ],
                logic: [
                    {
                        pattern: /if\s+\w+\s*=\s*[^=]/gi,
                        severity: 'medium',
                        title: 'Assignment in Condition',
                        description: 'Assignment in conditional might be unintentional.',
                        suggestion: 'Use == for comparison or wrap assignment in parentheses.',
                        score: -15
                    }
                ],
                quality: [
                    {
                        pattern: /def\s+\w+.*\n.*rescue\s*$/gi,
                        severity: 'low',
                        title: 'Bare Rescue Clause',
                        description: 'Bare rescue catches all exceptions, including system errors.',
                        suggestion: 'Rescue specific exception types: rescue StandardError.',
                        score: -5
                    }
                ]
            },
            go: {
                security: [
                    {
                        pattern: /fmt\.Sprintf.*SELECT.*%/gi,
                        severity: 'critical',
                        title: 'SQL Injection Vulnerability',
                        description: 'String formatting in SQL queries allows injection attacks.',
                        suggestion: 'Use parameterized queries with database/sql package.',
                        score: -25
                    },
                    {
                        pattern: /exec\.Command.*input/gi,
                        severity: 'high',
                        title: 'Command Injection Risk',
                        description: 'Executing commands with user input can be dangerous.',
                        suggestion: 'Validate and sanitize all inputs before executing.',
                        score: -20
                    }
                ],
                performance: [
                    {
                        pattern: /for.*range.*\{.*Query\(/gi,
                        severity: 'high',
                        title: 'Database Queries in Loop',
                        description: 'Multiple database queries in loops cause performance issues.',
                        suggestion: 'Use batch operations or single queries with JOINs.',
                        score: -20
                    }
                ],
                logic: [
                    {
                        pattern: /if\s+\w+\s*:=.*;.*err\s*!=\s*nil/gi,
                        severity: 'low',
                        title: 'Proper Error Handling',
                        description: 'Good Go error handling pattern.',
                        suggestion: 'Excellent! Continue checking errors explicitly.',
                        score: 5,
                        positive: true
                    }
                ],
                quality: [
                    {
                        pattern: /fmt\.Print/gi,
                        severity: 'low',
                        title: 'Print Statements in Code',
                        description: 'Print statements should not be in production code.',
                        suggestion: 'Use proper logging package like logrus or zap.',
                        score: -3
                    }
                ]
            },
            rust: {
                security: [
                    {
                        pattern: /unsafe\s*\{/gi,
                        severity: 'high',
                        title: 'Unsafe Code Block',
                        description: 'Unsafe blocks bypass Rust\'s memory safety guarantees.',
                        suggestion: 'Minimize unsafe code and document safety invariants.',
                        score: -15
                    }
                ],
                performance: [
                    {
                        pattern: /\.clone\(\).*\.clone\(\)/gi,
                        severity: 'medium',
                        title: 'Excessive Cloning',
                        description: 'Multiple clones can impact performance unnecessarily.',
                        suggestion: 'Use borrowing (&) instead of cloning when possible.',
                        score: -8
                    }
                ],
                logic: [
                    {
                        pattern: /unwrap\(\)/gi,
                        severity: 'medium',
                        title: 'Potential Panic with unwrap()',
                        description: 'unwrap() can cause panics if the value is None or Err.',
                        suggestion: 'Use match, if let, or expect() with descriptive messages.',
                        score: -10
                    }
                ],
                quality: [
                    {
                        pattern: /\?;|match.*\{.*Ok\(.*\).*Err\(.*\)/gi,
                        severity: 'low',
                        title: 'Proper Error Handling',
                        description: 'Good use of Rust error handling patterns.',
                        suggestion: 'Excellent! Proper error propagation and handling.',
                        score: 5,
                        positive: true
                    }
                ]
            }
        };

        function performAnalysis(commit, code, language) {
            const issues = [];
            let score = 85;

            // Get language-specific patterns
            const patterns = languagePatterns[language] || languagePatterns.javascript;

            // Apply all pattern categories
            ['security', 'performance', 'logic', 'quality'].forEach(category => {
                if (patterns[category]) {
                    patterns[category].forEach(pattern => {
                        const matches = [...code.matchAll(pattern.pattern)];
                        
                        matches.forEach(match => {
                            const lineNum = getLineNumber(code, pattern.pattern);
                            const codeSnippet = extractCodeSnippet(code, match[0]);
                            
                            issues.push({
                                type: category.charAt(0).toUpperCase() + category.slice(1),
                                severity: pattern.severity,
                                title: pattern.title,
                                description: pattern.description,
                                line: lineNum,
                                suggestion: pattern.suggestion,
                                code: codeSnippet,
                                positive: pattern.positive || false
                            });

                            score += pattern.score;
                        });
                    });
                }
            });

            // Add complexity analysis
            const complexity = analyzeComplexity(code);
            score += complexity.score;
            if (complexity.issues.length > 0) {
                issues.push(...complexity.issues);
            }

            // Language-specific enhancements
            const langAnalysis = getLanguageSpecificAnalysis(code, language);
            score += langAnalysis.scoreAdjustment;
            issues.push(...langAnalysis.issues);

            return {
                score: Math.max(0, Math.min(100, score)),
                issues: issues.sort((a, b) => getSeverityWeight(b.severity) - getSeverityWeight(a.severity)),
                language,
                platform: currentPlatform
            };
        }

        function extractCodeSnippet(code, matchText) {
            if (matchText.length > 80) {
                return matchText.substring(0, 77) + '...';
            }
            return matchText;
        }

        function analyzeComplexity(code) {
            const issues = [];
            let score = 0;
            
            // Count cyclomatic complexity
            const complexityPatterns = [
                /\bif\s*\(/gi, /\belse\s*if\s*\(/gi, /\bwhile\s*\(/gi, 
                /\bfor\s*\(/gi, /\bswitch\s*\(/gi, /\bcase\s+.*:/gi,
                /\bcatch\s*\(/gi, /&&|\|\|/gi
            ];
            
            let totalComplexity = 1; // Base complexity
            complexityPatterns.forEach(pattern => {
                const matches = code.match(pattern);
                if (matches) totalComplexity += matches.length;
            });

            // Analyze function length
            const lines = code.split('\n').filter(line => line.trim().length > 0);
            
            if (totalComplexity > 15) {
                issues.push({
                    type: 'Quality',
                    severity: 'high',
                    title: 'High Cyclomatic Complexity',
                    description: `Function has cyclomatic complexity of ${totalComplexity} (threshold: 10).`,
                    line: 1,
                    suggestion: 'Break down into smaller, focused functions.',
                    code: `Complexity: ${totalComplexity}`
                });
                score -= 15;
            } else if (totalComplexity > 10) {
                issues.push({
                    type: 'Quality',
                    severity: 'medium',
                    title: 'Moderate Complexity',
                    description: `Function complexity is ${totalComplexity}. Consider refactoring.`,
                    line: 1,
                    suggestion: 'Consider breaking into smaller functions.',
                    code: `Complexity: ${totalComplexity}`
                });
                score -= 8;
            }

            if (lines.length > 100) {
                issues.push({
                    type: 'Quality',
                    severity: 'medium',
                    title: 'Very Long Function',
                    description: `Function has ${lines.length} lines (threshold: 50).`,
                    line: 1,
                    suggestion: 'Break into smaller, focused functions.',
                    code: `${lines.length} lines of code`
                });
                score -= 12;
            } else if (lines.length > 50) {
                issues.push({
                    type: 'Quality',
                    severity: 'low',
                    title: 'Long Function',
                    description: `Function has ${lines.length} lines. Consider refactoring.`,
                    line: 1,
                    suggestion: 'Consider breaking into smaller functions.',
                    code: `${lines.length} lines of code`
                });
                score -= 5;
            }

            return { issues, score };
        }

        function getLanguageSpecificAnalysis(code, language) {
            const issues = [];
            let scoreAdjustment = 0;

            // Additional language-specific checks
            switch (language) {
                case 'javascript':
                case 'typescript':
                    // Check for console statements
                    if (/console\.(log|error|warn|info)/gi.test(code)) {
                        issues.push({
                            type: 'Quality',
                            severity: 'low',
                            title: 'Debug Console Statements',
                            description: 'Console statements should be removed from production code.',
                            line: getLineNumber(code, /console\./gi),
                            suggestion: 'Use proper logging library or remove debug statements.',
                            code: code.match(/console\.[^;]*/gi)?.[0] || 'Console statement'
                        });
                        scoreAdjustment -= 2;
                    }

                    // Check for proper async/await usage
                    if (/async.*function.*\{[^}]*(?!await)[^}]*Promise\./gi.test(code)) {
                        issues.push({
                            type: 'Best Practice',
                            severity: 'medium',
                            title: 'Missing await in Async Function',
                            description: 'Async function contains Promise without await.',
                            line: getLineNumber(code, /async.*function/gi),
                            suggestion: 'Use await with Promise calls in async functions.',
                            code: 'Async function with unhandled Promise'
                        });
                        scoreAdjustment -= 8;
                    }

                    // TypeScript specific checks
                    if (language === 'typescript') {
                        if (/any\s*;|:\s*any/gi.test(code)) {
                            issues.push({
                                type: 'Type Safety',
                                severity: 'medium',
                                title: 'Usage of "any" Type',
                                description: 'Using "any" defeats the purpose of TypeScript\'s type safety.',
                                line: getLineNumber(code, /any\s*;|:\s*any/gi),
                                suggestion: 'Use specific types or interfaces instead of "any".',
                                code: 'any type usage detected'
                            });
                            scoreAdjustment -= 10;
                        }
                    }
                    break;

                case 'python':
                    // Check for print statements
                    if (/print\s*\(/gi.test(code)) {
                        issues.push({
                            type: 'Quality',
                            severity: 'low',
                            title: 'Print Statements in Code',
                            description: 'Print statements should be replaced with proper logging.',
                            line: getLineNumber(code, /print\s*\(/gi),
                            suggestion: 'Use logging module instead of print statements.',
                            code: code.match(/print\([^)]*\)/gi)?.[0] || 'Print statement'
                        });
                        scoreAdjustment -= 2;
                    }

                    // Check for list comprehension instead of loops
                    if (/for\s+\w+\s+in.*:\s*\n\s*\w+\.append/gi.test(code)) {
                        issues.push({
                            type: 'Best Practice',
                            severity: 'low',
                            title: 'Use List Comprehension',
                            description: 'Simple append loops can be replaced with list comprehensions.',
                            line: getLineNumber(code, /for\s+\w+\s+in.*:\s*\n\s*\w+\.append/gi),
                            suggestion: 'Use list comprehension for better readability and performance.',
                            code: 'For loop with append'
                        });
                        scoreAdjustment -= 3;
                    }

                    // Check for proper docstrings
                    if (/def\s+\w+.*:\s*\n\s*""".*"""/gi.test(code)) {
                        issues.push({
                            type: 'Documentation',
                            severity: 'low',
                            title: 'Good Documentation',
                            description: 'Function has proper docstring documentation.',
                            line: getLineNumber(code, /def\s+\w+/gi),
                            suggestion: 'Excellent! Continue documenting functions.',
                            code: 'Docstring present',
                            positive: true
                        });
                        scoreAdjustment += 3;
                    }
                    break;

                case 'java':
                    // Check for proper exception handling
                    if (/catch\s*\(\s*Exception\s+/gi.test(code)) {
                        issues.push({
                            type: 'Error Handling',
                            severity: 'medium',
                            title: 'Catching Generic Exception',
                            description: 'Catching generic Exception can hide specific error types.',
                            line: getLineNumber(code, /catch\s*\(\s*Exception/gi),
                            suggestion: 'Catch specific exception types when possible.',
                            code: 'catch (Exception e)'
                        });
                        scoreAdjustment -= 8;
                    }

                    // Check for proper resource management
                    if (/try\s*\([^)]*\)/gi.test(code)) {
                        issues.push({
                            type: 'Resource Management',
                            severity: 'low',
                            title: 'Try-with-Resources',
                            description: 'Good use of try-with-resources for automatic resource management.',
                            line: getLineNumber(code, /try\s*\(/gi),
                            suggestion: 'Excellent! Resources will be automatically closed.',
                            code: 'Try-with-resources detected',
                            positive: true
                        });
                        scoreAdjustment += 5;
                    }
                    break;

                case 'csharp':
                    // Check for proper null checking
                    if (/\w+\.\w+.*null/gi.test(code) && !/\?\./gi.test(code)) {
                        issues.push({
                            type: 'Null Safety',
                            severity: 'medium',
                            title: 'Potential Null Reference',
                            description: 'Object might be null before accessing its members.',
                            line: getLineNumber(code, /\w+\.\w+/gi),
                            suggestion: 'Use null-conditional operator (?.) or null checking.',
                            code: 'Potential null reference access'
                        });
                        scoreAdjustment -= 10;
                    }

                    // Check for async/await best practices
                    if (/\.Result|\.Wait\(\)/gi.test(code)) {
                        issues.push({
                            type: 'Async Pattern',
                            severity: 'high',
                            title: 'Blocking Async Call',
                            description: 'Using .Result or .Wait() can cause deadlocks.',
                            line: getLineNumber(code, /\.Result|\.Wait\(\)/gi),
                            suggestion: 'Use await instead of .Result or .Wait().',
                            code: code.match(/\.[^;]*(?:Result|Wait\(\))/gi)?.[0] || 'Blocking async call'
                        });
                        scoreAdjustment -= 15;
                    }
                    break;

                case 'php':
                    // Check for error reporting
                    if (/error_reporting\(0\)|ini_set.*error_reporting.*0/gi.test(code)) {
                        issues.push({
                            type: 'Error Handling',
                            severity: 'medium',
                            title: 'Error Reporting Disabled',
                            description: 'Disabling error reporting can hide important issues.',
                            line: getLineNumber(code, /error_reporting\(0\)/gi),
                            suggestion: 'Use proper error handling instead of disabling error reporting.',
                            code: 'Error reporting disabled'
                        });
                        scoreAdjustment -= 10;
                    }

                    // Check for proper variable initialization
                    if (/\$\w+\s*=.*\$_(?:GET|POST|REQUEST)\[/gi.test(code)) {
                        issues.push({
                            type: 'Security',
                            severity: 'high',
                            title: 'Unsanitized Input Usage',
                            description: 'Direct use of superglobal variables without sanitization.',
                            line: getLineNumber(code, /\$_(?:GET|POST|REQUEST)/gi),
                            suggestion: 'Sanitize and validate all user inputs using filter_var() or similar.',
                            code: code.match(/\$\w+\s*=.*\$_(?:GET|POST|REQUEST)\[[^\]]*\]/gi)?.[0] || 'Unsanitized input'
                        });
                        scoreAdjustment -= 20;
                    }
                    break;

                case 'ruby':
                    // Check for proper string interpolation
                    if (/\+.*".*".*\+/gi.test(code)) {
                        issues.push({
                            type: 'Best Practice',
                            severity: 'low',
                            title: 'String Concatenation',
                            description: 'String concatenation with + is less efficient than interpolation.',
                            line: getLineNumber(code, /\+.*".*".*\+/gi),
                            suggestion: 'Use string interpolation: "text #{variable}" instead of concatenation.',
                            code: 'String concatenation with +'
                        });
                        scoreAdjustment -= 3;
                    }

                    // Check for proper method naming
                    if (/def\s+[A-Z]\w*/gi.test(code)) {
                        issues.push({
                            type: 'Naming Convention',
                            severity: 'low',
                            title: 'Method Naming Convention',
                            description: 'Ruby method names should be snake_case, not PascalCase.',
                            line: getLineNumber(code, /def\s+[A-Z]\w*/gi),
                            suggestion: 'Use snake_case for method names: def my_method instead of def MyMethod.',
                            code: code.match(/def\s+[A-Z]\w*/gi)?.[0] || 'PascalCase method name'
                        });
                        scoreAdjustment -= 2;
                    }
                    break;

                case 'go':
                    // Check for proper error handling patterns
                    if (/err\s*:=.*\n(?!\s*if\s+err\s*!=\s*nil)/gi.test(code)) {
                        issues.push({
                            type: 'Error Handling',
                            severity: 'medium',
                            title: 'Unchecked Error',
                            description: 'Error variable assigned but not checked immediately.',
                            line: getLineNumber(code, /err\s*:=/gi),
                            suggestion: 'Check error immediately after assignment: if err != nil { ... }',
                            code: 'Unchecked error variable'
                        });
                        scoreAdjustment -= 10;
                    }

                    // Check for goroutine best practices
                    if (/go\s+func.*\{.*panic/gi.test(code)) {
                        issues.push({
                            type: 'Concurrency',
                            severity: 'high',
                            title: 'Panic in Goroutine',
                            description: 'Panic in goroutine can crash the entire program.',
                            line: getLineNumber(code, /go\s+func/gi),
                            suggestion: 'Handle errors gracefully in goroutines, avoid panic.',
                            code: 'Goroutine with panic'
                        });
                        scoreAdjustment -= 15;
                    }
                    break;

                case 'rust':
                    // Check for proper Option/Result handling
                    if (/\.unwrap\(\).*\.unwrap\(\)/gi.test(code)) {
                        issues.push({
                            type: 'Error Handling',
                            severity: 'high',
                            title: 'Multiple unwrap() Calls',
                            description: 'Multiple unwrap() calls can cause cascading panics.',
                            line: getLineNumber(code, /\.unwrap\(\)/gi),
                            suggestion: 'Use ? operator or proper error handling with match.',
                            code: 'Multiple unwrap() calls'
                        });
                        scoreAdjustment -= 12;
                    }

                    // Check for lifetime annotations
                    if (/'[a-z]+.*struct.*\{/gi.test(code)) {
                        issues.push({
                            type: 'Memory Management',
                            severity: 'low',
                            title: 'Proper Lifetime Management',
                            description: 'Good use of lifetime annotations in structs.',
                            line: getLineNumber(code, /'[a-z]+/gi),
                            suggestion: 'Excellent! Proper lifetime management prevents dangling references.',
                            code: 'Lifetime annotations present',
                            positive: true
                        });
                        scoreAdjustment += 5;
                    }
                    break;
            }

            return { issues, scoreAdjustment };
        }

        function getLineNumber(code, pattern) {
            const match = code.search(pattern);
            if (match === -1) return 1;
            return code.substring(0, match).split('\n').length;
        }

        function getSeverityWeight(severity) {
            const weights = { critical: 4, high: 3, medium: 2, low: 1 };
            return weights[severity] || 0;
        }

        function showResults(analysis) {
            const resultsDiv = document.getElementById('results');
            const summaryDiv = document.getElementById('summary');
            const issuesDiv = document.getElementById('issues');

            // Summary
            const negativeIssues = analysis.issues.filter(i => !i.positive);
            const criticalCount = negativeIssues.filter(i => i.severity === 'critical').length;
            const highCount = negativeIssues.filter(i => i.severity === 'high').length;
            const mediumCount = negativeIssues.filter(i => i.severity === 'medium').length;
            const lowCount = negativeIssues.filter(i => i.severity === 'low').length;

            const riskLevel = analysis.score >= 80 ? 'Low Risk' : 
                             analysis.score >= 60 ? 'Medium Risk' : 'High Risk';

            const scoreColor = analysis.score >= 80 ? 'var(--success-color)' : 
                              analysis.score >= 60 ? 'var(--warning-color)' : 'var(--error-color)';

            summaryDiv.innerHTML = `
                <div class="summary-header">
                    <div>
                        <div class="summary-title">Code Review Results</div>
                        <div style="margin-top: 0.5rem;">
                            <div><strong>Platform:</strong> ${analysis.platform.charAt(0).toUpperCase() + analysis.platform.slice(1)}</div>
                            <div><strong>Language:</strong> ${analysis.language.charAt(0).toUpperCase() + analysis.language.slice(1)}</div>
                            <div><strong>Risk Level:</strong> <span style="color: ${scoreColor};">${riskLevel}</span></div>
                        </div>
                    </div>
                    <div class="score-display">
                        <div class="score-number" style="color: ${scoreColor};">${analysis.score}</div>
                        <div class="score-label">out of 100</div>
                    </div>
                </div>
                ${negativeIssues.length > 0 ? `
                    <div class="summary-badges">
                        ${criticalCount > 0 ? `<div class="badge critical">🚨 ${criticalCount} Critical</div>` : ''}
                        ${highCount > 0 ? `<div class="badge high">⚠️ ${highCount} High</div>` : ''}
                        ${mediumCount > 0 ? `<div class="badge medium">⚡ ${mediumCount} Medium</div>` : ''}
                        ${lowCount > 0 ? `<div class="badge low">ℹ️ ${lowCount} Info</div>` : ''}
                    </div>
                ` : ''}
            `;

            // Issues
            if (analysis.issues.length === 0 || negativeIssues.length === 0) {
                issuesDiv.innerHTML = `
                    <div class="no-issues">
                        <div class="no-issues-icon">🎉</div>
                        <h3>No Issues Found!</h3>
                        <p>Your code looks clean and follows best practices.</p>
                    </div>
                `;
            } else {
                issuesDiv.innerHTML = negativeIssues.map(issue => {
                    const severityIcon = {
                        critical: '🚨',
                        high: '⚠️',
                        medium: '⚡',
                        low: 'ℹ️'
                    }[issue.severity];

                    return `
                        <div class="issue-card ${issue.severity}">
                            <div class="issue-header">
                                <div class="issue-title">${issue.title}</div>
                                <div class="issue-meta">
                                    <div class="badge ${issue.severity}">
                                        ${severityIcon} ${issue.severity.charAt(0).toUpperCase() + issue.severity.slice(1)}
                                    </div>
                                    <div style="font-size: 0.85rem; color: var(--text-secondary);">
                                        Line ${issue.line} • ${issue.type}
                                    </div>
                                </div>
                            </div>
                            <div class="issue-description">${issue.description}</div>
                            <div class="code-block">${issue.code}</div>
                            <div class="suggestion">
                                <div class="suggestion-title">💡 Suggestion</div>
                                <div>${issue.suggestion}</div>
                            </div>
                        </div>
                    `;
                }).join('');
            }}
            
